{"version":3,"sources":["../src/vim.js"],"names":["Plugin","activate","vim","editor","inkdrop","getActiveEditor","activateMode","on","handleEditorInit","deactivate","disposables","dispose","deactivateMode","cm","codeMirror","originalKeyMap","getOption","setOption","handleVimModeChange","handleFocusEditor","el","getWrapperElement","classList","add","registerCommands","registerExCommands","off","remove","startBufferingKey","command","wrapper","getCodeMirror","pendingCommand","stopBufferingKey","undefined","isBufferingKey","contains","bufferKey","key","maybeInitVimState","vimKey","cmKeyToVimKey","inputState","keyBuffer","debug","isInsertMode","h","e","stopPropagation","operation","curOp","isVimOp","commandDispatcher","processCommand","state","Vim","suppressErrorLogging","console","error","b","originalEvent","handlers","clearInputState","exitVisualMode","exitInsertMode","keys","type","motion","motionArgs","forward","linewise","wordEnd","bigWord","inclusive","toJumplist","toFirstChar","repeatOffset","explicitRepeat","action","actionArgs","position","operator","context","toKeys","isEdit","insertAt","operatorArgs","indentRight","after","toLower","shouldMoveCursor","searchArgs","querySrc","wholeWordOnly","replace","blockwise","interlaceInsertRepeat","operatorMotionArgs","visualLine","increase","backtrack","commands","node","addEventListener","handleEditorKeyDown","removeEventListener","defineEx","dispatch","yankClipboard","getVimGlobalState","text","readText","indexOf","registerController","pushText","event","opt","mode","keyName","length","selectedCharacter","test","keysMatcher","exec","pushRepeatDigit","module","exports"],"mappings":"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","file":"vim.js","sourcesContent":["import vimKeymap from './keymap'\nimport { CompositeDisposable, Disposable, CodeMirror } from 'inkdrop'\nimport { autobind } from 'core-decorators'\nimport { clipboard } from 'electron'\n\nclass Plugin {\n  activate () {\n    this.vim = vimKeymap(CodeMirror)\n    const editor = inkdrop.getActiveEditor()\n    if (editor) {\n      this.activateMode(editor)\n    }\n    inkdrop.on('editor:init', this.handleEditorInit)\n  }\n\n  deactivate () {\n    if (this.disposables) {\n      this.disposables.dispose()\n    }\n    const editor = inkdrop.getActiveEditor()\n    if (editor) {\n      this.deactivateMode(editor)\n    }\n  }\n\n  activateMode (editor) {\n    const cm = editor.codeMirror\n    this.originalKeyMap = cm.getOption('keyMap')\n    cm.setOption('keyMap', 'vim')\n    cm.on('vim-mode-change', this.handleVimModeChange)\n    cm.on('focus', this.handleFocusEditor)\n\n    const el = cm.getWrapperElement()\n    el.classList.add('vim-mode', 'normal-mode')\n\n    this.registerCommands()\n    this.registerExCommands()\n  }\n\n  deactivateMode (editor) {\n    const cm = editor.codeMirror\n    if (cm && this.originalKeyMap) {\n      editor.codeMirror.setOption('keyMap', this.originalKeyMap)\n      cm.off('vim-mode-change', this.handleVimModeChange)\n      const el = cm.getWrapperElement()\n      el.classList.remove('vim-mode')\n    }\n  }\n\n  startBufferingKey (command) {\n    const wrapper = this.getCodeMirror().getWrapperElement()\n    wrapper.classList.add('key-buffering')\n    this.pendingCommand = command\n  }\n\n  stopBufferingKey () {\n    const wrapper = this.getCodeMirror().getWrapperElement()\n    wrapper.classList.remove('key-buffering')\n    this.pendingCommand = undefined\n  }\n\n  isBufferingKey () {\n    const wrapper = this.getCodeMirror().getWrapperElement()\n    return wrapper.classList.contains('key-buffering')\n  }\n\n  bufferKey (key) {\n    const cm = this.getCodeMirror()\n    const vim = this.vim.maybeInitVimState(cm)\n    const vimKey = this.vim.cmKeyToVimKey(\"'\" + key + \"'\")\n    vim.inputState.keyBuffer = vim.inputState.keyBuffer + vimKey\n    debug('keyBuffer:', vim.inputState.keyBuffer)\n  }\n\n  isInsertMode () {\n    const wrapper = this.getCodeMirror().getWrapperElement()\n    return wrapper.classList.contains('insert-mode')\n  }\n\n  registerCommands () {\n    const disposables = new CompositeDisposable()\n    const editor = inkdrop.getActiveEditor()\n    const cm = editor.codeMirror\n    const wrapper = cm.getWrapperElement()\n    // bind key to command\n    const h = (command) => {\n      return (e) => {\n        debug('command:', command)\n        e.stopPropagation()\n        const vim = this.vim.maybeInitVimState(cm)\n        return cm.operation(() => {\n          cm.curOp.isVimOp = true\n          try {\n            this.vim.commandDispatcher.processCommand(cm, vim, command)\n          } catch (e) {\n            // clear VIM state in case it's in a bad state.\n            cm.state.vim = undefined\n            this.vim.maybeInitVimState(cm)\n            if (!CodeMirror.Vim.suppressErrorLogging) {\n              console.error(e)\n            }\n            throw e\n          }\n          return true\n        })\n      }\n    }\n    // bind keystroke to command\n    const b = (command) => {\n      return (e) => {\n        debug('buffer command:', command, e.originalEvent)\n        this.startBufferingKey(h(command))\n        this.bufferKey(e.originalEvent.key)\n      }\n    }\n    const handlers = {\n      'vim-mode:native!': () => {},\n      'vim-mode:reset-normal-mode': (e) => {\n        CodeMirror.Vim.clearInputState(cm)\n        this.stopBufferingKey()\n        e.stopPropagation()\n      },\n      'vim-mode:exit-visual-mode': (e) => {\n        debug('exit-visual-mode')\n        CodeMirror.Vim.clearInputState(cm)\n        CodeMirror.Vim.exitVisualMode(cm)\n        this.stopBufferingKey()\n        e.stopPropagation()\n      },\n      'vim-mode:exit-insert-mode': (e) => {\n        debug('exit-insert-mode')\n        CodeMirror.Vim.clearInputState(cm)\n        CodeMirror.Vim.exitInsertMode(cm)\n        this.stopBufferingKey()\n        e.stopPropagation()\n      },\n      'vim-mode:move-left': h({ keys: 'h', type: 'motion', motion: 'moveByCharacters', motionArgs: { forward: false } }),\n      'vim-mode:move-right': h({ keys: 'l', type: 'motion', motion: 'moveByCharacters', motionArgs: { forward: true } }),\n      'vim-mode:move-up': h({ keys: 'k', type: 'motion', motion: 'moveByLines', motionArgs: { forward: false, linewise: true } }),\n      'vim-mode:move-down': h({ keys: 'j', type: 'motion', motion: 'moveByLines', motionArgs: { forward: true, linewise: true } }),\n\n      'vim-mode:move-to-next-word': h({ keys: 'w', type: 'motion', motion: 'moveByWords', motionArgs: { forward: true, wordEnd: false } }),\n      'vim-mode:move-to-next-whole-word': h({ keys: 'W', type: 'motion', motion: 'moveByWords', motionArgs: { forward: true, wordEnd: false, bigWord: true } }),\n      'vim-mode:move-to-end-of-word': h({ keys: 'e', type: 'motion', motion: 'moveByWords', motionArgs: { forward: true, wordEnd: true, inclusive: true } }),\n      'vim-mode:move-to-previous-end-of-word': h({ keys: 'ge', type: 'motion', motion: 'moveByWords', motionArgs: { forward: false, wordEnd: true, inclusive: true } }),\n      'vim-mode:move-to-end-of-whole-word': h({ keys: 'E', type: 'motion', motion: 'moveByWords', motionArgs: { forward: true, wordEnd: true, bigWord: true, inclusive: true } }),\n      'vim-mode:move-to-previous-end-of-whole-word': h({ keys: 'gE', type: 'motion', motion: 'moveByWords', motionArgs: { forward: false, wordEnd: true, bigWord: true, inclusive: true } }),\n      'vim-mode:move-to-previous-word': h({ keys: 'b', type: 'motion', motion: 'moveByWords', motionArgs: { forward: false, wordEnd: false } }),\n      'vim-mode:move-to-previous-whole-word': h({ keys: 'B', type: 'motion', motion: 'moveByWords', motionArgs: { forward: false, wordEnd: false, bigWord: true } }),\n      'vim-mode:move-to-next-paragraph': h({ keys: '}', type: 'motion', motion: 'moveByParagraph', motionArgs: { forward: true, toJumplist: true } }),\n      'vim-mode:move-to-previous-paragraph': h({ keys: '{', type: 'motion', motion: 'moveByParagraph', motionArgs: { forward: false, toJumplist: true } }),\n      'vim-mode:move-to-beginning-of-line': h({ keys: '0', type: 'motion', motion: 'moveToStartOfLine' }),\n      'vim-mode:move-to-first-character-of-line': h({ keys: '^', type: 'motion', motion: 'moveToFirstNonWhiteSpaceCharacter' }),\n      'vim-mode:move-to-first-character-of-line-and-down': h({ keys: '_', type: 'motion', motion: 'moveByLines', motionArgs: { forward: true, toFirstChar: true, repeatOffset: -1 } }),\n      'vim-mode:move-to-last-character-of-line': h({ keys: '$', type: 'motion', motion: 'moveToEol', motionArgs: { inclusive: true } }),\n      'vim-mode:move-to-last-nonblank-character-of-line-and-down': () => { '???' },\n      'vim-mode:move-to-first-character-of-line-up': h({ keys: '-', type: 'motion', motion: 'moveByLines', motionArgs: { forward: false, toFirstChar: true } }),\n      'vim-mode:move-to-first-character-of-line-down': h({ keys: '+', type: 'motion', motion: 'moveByLines', motionArgs: { forward: true, toFirstChar: true } }),\n\n      'vim-mode:move-to-start-of-file': h({ keys: 'gg', type: 'motion', motion: 'moveToLineOrEdgeOfDocument', motionArgs: { forward: false, explicitRepeat: true, linewise: true, toJumplist: true } }),\n      'vim-mode:scroll-half-screen-up': h({ keys: '<C-u>', type: 'motion', motion: 'moveByScroll', motionArgs: { forward: false, explicitRepeat: true } }),\n      'vim-mode:scroll-full-screen-up': h({ keys: '<C-b>', type: 'motion', motion: 'moveByPage', motionArgs: { forward: false } }),\n      'vim-mode:scroll-half-screen-down': h({ keys: '<C-d>', type: 'motion', motion: 'moveByScroll', motionArgs: { forward: true, explicitRepeat: true } }),\n      'vim-mode:scroll-full-screen-down': h({ keys: '<C-f>', type: 'motion', motion: 'moveByPage', motionArgs: { forward: true } }),\n      'vim-mode:scroll-down': h({ keys: '<C-e>', type: 'action', action: 'scroll', actionArgs: { forward: true, linewise: true } }),\n      'vim-mode:scroll-up': h({ keys: '<C-y>', type: 'action', action: 'scroll', actionArgs: { forward: false, linewise: true } }),\n      'vim-mode:scroll-cursor-to-top': h({ keys: 'z<CR>', type: 'action', action: 'scrollToCursor', actionArgs: { position: 'top' }, motion: 'moveToFirstNonWhiteSpaceCharacter' }),\n      'vim-mode:scroll-cursor-to-top-leave': h({ keys: 'zt', type: 'action', action: 'scrollToCursor', actionArgs: { position: 'top' } }),\n      'vim-mode:scroll-cursor-to-middle': h({ keys: 'z.', type: 'action', action: 'scrollToCursor', actionArgs: { position: 'center' }, motion: 'moveToFirstNonWhiteSpaceCharacter' }),\n      'vim-mode:scroll-cursor-to-middle-leave': h({ keys: 'zz', type: 'action', action: 'scrollToCursor', actionArgs: { position: 'center' } }),\n      'vim-mode:scroll-cursor-to-bottom': h({ keys: 'z-', type: 'action', action: 'scrollToCursor', actionArgs: { position: 'bottom' } }),\n      'vim-mode:scroll-cursor-to-bottom-leave': h({ keys: 'zb', type: 'action', action: 'scrollToCursor', actionArgs: { position: 'bottom' }, motion: 'moveToFirstNonWhiteSpaceCharacter' }),\n      'vim-mode:move-to-line': h({ keys: 'G', type: 'motion', motion: 'moveToLineOrEdgeOfDocument', motionArgs: { forward: true, explicitRepeat: true, linewise: true, toJumplist: true } }),\n      'vim-mode:move-to-top-of-screen': h({ keys: 'H', type: 'motion', motion: 'moveToTopLine', motionArgs: { linewise: true, toJumplist: true } }),\n      'vim-mode:move-to-bottom-of-screen': h({ keys: 'L', type: 'motion', motion: 'moveToBottomLine', motionArgs: { linewise: true, toJumplist: true } }),\n      'vim-mode:move-to-middle-of-screen': h({ keys: 'M', type: 'motion', motion: 'moveToMiddleLine', motionArgs: { linewise: true, toJumplist: true } }),\n\n      'vim-mode:delete': h({ keys: 'd', type: 'operator', operator: 'delete' }),\n      'vim-mode:delete-to-last-character-of-line': h({ keys: 'D', type: 'operatorMotion', operator: 'delete', motion: 'moveToEol', motionArgs: { inclusive: true }, context: 'normal' }),\n      'vim-mode:change': h({ keys: 'c', type: 'operator', operator: 'change' }),\n      'vim-mode:change-to-last-character-of-line': h({ keys: 'C', type: 'operatorMotion', operator: 'change', motion: 'moveToEol', motionArgs: { inclusive: true }, context: 'normal' }),\n      'vim-mode:substitute-line': h({ keys: 'S', type: 'keyToKey', toKeys: 'cc', context: 'normal' }),\n      'vim-mode:replace': b({ keys: 'r<character>', type: 'action', action: 'replace', isEdit: true }),\n      'vim-mode:insert-at-beginning-of-line': h({ keys: 'I', type: 'action', action: 'enterInsertMode', isEdit: true, actionArgs: { insertAt: 'firstNonBlank' }, context: 'normal' }),\n      'vim-mode:indent': h({ keys: '>', type: 'operator', operator: 'indent', operatorArgs: { indentRight: true } }),\n      'vim-mode:outdent': h({ keys: '<', type: 'operator', operator: 'indent', operatorArgs: { indentRight: false } }),\n      'vim-mode:auto-indent': () => { 'not supported' },\n      'vim-mode:join': h({ keys: 'J', type: 'action', action: 'joinLines', isEdit: true }),\n\n      'vim-mode:yank': h({ keys: 'y', type: 'operator', operator: 'yank' }),\n      'vim-mode:yank-line': h({ keys: 'Y', type: 'operatorMotion', operator: 'yank', motion: 'expandToLine', motionArgs: { linewise: true }, context: 'normal' }),\n      'vim-mode:put-before': h({ keys: 'P', type: 'action', action: 'paste', isEdit: true, actionArgs: { after: false, isEdit: true } }),\n      'vim-mode:put-after': h({ keys: 'p', type: 'action', action: 'paste', isEdit: true, actionArgs: { after: true, isEdit: true } }),\n\n      'vim-mode:toggle-case': h({ keys: 'g~', type: 'operator', operator: 'changeCase' }),\n      'vim-mode:upper-case': h({ keys: 'gU', type: 'operator', operator: 'changeCase', operatorArgs: {toLower: false}, isEdit: true }),\n      'vim-mode:lower-case': h({ keys: 'gu', type: 'operator', operator: 'changeCase', operatorArgs: {toLower: true}, isEdit: true }),\n      'vim-mode:toggle-case-now': h({ keys: '~', type: 'operatorMotion', operator: 'changeCase', motion: 'moveByCharacters', motionArgs: { forward: true }, operatorArgs: { shouldMoveCursor: true }, context: 'normal' }),\n\n      'vim-mode:mark': b({ keys: 'm<character>', type: 'action', action: 'setMark' }),\n      'vim-mode:move-to-mark-literal': b({ keys: '`<character>', type: 'motion', motion: 'goToMark', motionArgs: { toJumplist: true } }),\n      'vim-mode:move-to-mark': b({ keys: '\\'<character>', type: 'motion', motion: 'goToMark', motionArgs: {toJumplist: true, linewise: true} }),\n\n      'vim-mode:find': b({ keys: 'f<character>', type: 'motion', motion: 'moveToCharacter', motionArgs: { forward: true, inclusive: true } }),\n      'vim-mode:find-backwards': b({ keys: 'F<character>', type: 'motion', motion: 'moveToCharacter', motionArgs: { forward: false } }),\n      'vim-mode:till': b({ keys: 't<character>', type: 'motion', motion: 'moveTillCharacter', motionArgs: { forward: true, inclusive: true } }),\n      'vim-mode:till-backwards': b({ keys: 'T<character>', type: 'motion', motion: 'moveTillCharacter', motionArgs: { forward: false } }),\n      'vim-mode:repeat-find': h({ keys: ';', type: 'motion', motion: 'repeatLastCharacterSearch', motionArgs: { forward: true } }),\n      'vim-mode:repeat-find-reverse': h({ keys: ',', type: 'motion', motion: 'repeatLastCharacterSearch', motionArgs: { forward: false } }),\n\n      'vim-mode:search': h({ keys: '/', type: 'search', searchArgs: { forward: true, querySrc: 'prompt', toJumplist: true } }),\n      'vim-mode:reverse-search': h({ keys: '?', type: 'search', searchArgs: { forward: false, querySrc: 'prompt', toJumplist: true } }),\n      'vim-mode:search-current-word': h({ keys: '*', type: 'search', searchArgs: { forward: true, querySrc: 'wordUnderCursor', wholeWordOnly: true, toJumplist: true } }),\n      'vim-mode:reverse-search-current-word': h({ keys: '#', type: 'search', searchArgs: { forward: false, querySrc: 'wordUnderCursor', wholeWordOnly: true, toJumplist: true } }),\n      'vim-mode:repeat-search': h({ keys: 'n', type: 'motion', motion: 'findNext', motionArgs: { forward: true, toJumplist: true } }),\n      'vim-mode:repeat-search-backwards': h({ keys: 'N', type: 'motion', motion: 'findNext', motionArgs: { forward: false, toJumplist: true } }),\n\n      'vim-mode:bracket-matching-motion': h({ keys: '%', type: 'motion', motion: 'moveToMatchedSymbol', motionArgs: { inclusive: true, toJumplist: true } }),\n\n      'vim-mode:ex-command': h({ keys: ':', type: 'ex' }),\n\n      // normal mode\n      'vim-mode:activate-insert-mode': h({ keys: 'i', type: 'action', action: 'enterInsertMode', isEdit: true, actionArgs: { insertAt: 'inplace' }, context: 'normal' }),\n      'vim-mode:activate-replace-mode': h({ keys: 'R', type: 'action', action: 'enterInsertMode', isEdit: true, actionArgs: { replace: true } }),\n      'vim-mode:activate-characterwise-visual-mode': h({ keys: 'v', type: 'action', action: 'toggleVisualMode' }),\n      'vim-mode:activate-linewise-visual-mode': h({ keys: 'V', type: 'action', action: 'toggleVisualMode', actionArgs: { linewise: true } }),\n      'vim-mode:activate-blockwise-visual-mode': h({ keys: '<C-v>', type: 'action', action: 'toggleVisualMode', actionArgs: { blockwise: true } }),\n\n      'vim-mode:undo': h({ keys: 'u', type: 'action', action: 'undo', context: 'normal' }),\n\n      'vim-mode:insert-above-with-newline': h({ keys: 'O', type: 'action', action: 'newLineAndEnterInsertMode', isEdit: true, interlaceInsertRepeat: true, actionArgs: { after: false }, context: 'normal' }),\n      'vim-mode:insert-below-with-newline': h({ keys: 'o', type: 'action', action: 'newLineAndEnterInsertMode', isEdit: true, interlaceInsertRepeat: true, actionArgs: { after: true }, context: 'normal' }),\n      'vim-mode:insert-after': h({ keys: 'a', type: 'action', action: 'enterInsertMode', isEdit: true, actionArgs: { insertAt: 'charAfter' }, context: 'normal' }),\n      'vim-mode:insert-after-end-of-line': h({ keys: 'A', type: 'action', action: 'enterInsertMode', isEdit: true, actionArgs: { insertAt: 'eol' }, context: 'normal' }),\n      'vim-mode:delete-right': h({ keys: 'x', type: 'operatorMotion', operator: 'delete', motion: 'moveByCharacters', motionArgs: { forward: true }, operatorMotionArgs: { visualLine: false } }),\n      'vim-mode:delete-left': h({ keys: 'X', type: 'operatorMotion', operator: 'delete', motion: 'moveByCharacters', motionArgs: { forward: false }, operatorMotionArgs: { visualLine: true } }),\n      'vim-mode:substitute': h({ keys: 's', type: 'keyToKey', toKeys: 'cl', context: 'normal' }),\n      'vim-mode:repeat': h({ keys: '.', type: 'action', action: 'repeatLastEdit' }),\n\n      'vim-mode:increase': h({ keys: '<C-a>', type: 'action', action: 'incrementNumberToken', isEdit: true, actionArgs: { increase: true, backtrack: false } }),\n      'vim-mode:decrease': h({ keys: '<C-x>', type: 'action', action: 'incrementNumberToken', isEdit: true, actionArgs: {increase: false, backtrack: false} }),\n\n      'vim-mode:register-prefix': b({ keys: '\"<character>', type: 'action', action: 'setRegister' }),\n\n      // insert mode\n      'vim-mode:delete-to-beginning-of-word': h({ keys: '<C-w>', type: 'operatorMotion', operator: 'delete', motion: 'moveByWords', motionArgs: { forward: false, wordEnd: false }, context: 'insert' })\n    }\n    disposables.add(inkdrop.commands.add(editor.node, handlers))\n    wrapper.addEventListener('keydown', this.handleEditorKeyDown)\n    disposables.add(new Disposable(() => wrapper.removeEventListener('keydown', this.handleEditorKeyDown)))\n\n    this.disposables = disposables\n  }\n\n  registerExCommands () {\n    const el = this.getCodeMirror().getWrapperElement()\n    this.vim.defineEx('write', 'w', () => {\n      inkdrop.commands.dispatch(el, 'core:save-note')\n    })\n    this.vim.defineEx('next', 'n', () => {\n      inkdrop.commands.dispatch(el, 'core:open-next-note')\n    })\n    this.vim.defineEx('prev', '', () => {\n      inkdrop.commands.dispatch(el, 'core:open-prev-note')\n    })\n    this.vim.defineEx('preview', 'p', () => {\n      inkdrop.commands.dispatch(el, 'view:toggle-preview')\n    })\n    this.vim.defineEx('side-by-side', 'side', () => {\n      inkdrop.commands.dispatch(el, 'view:toggle-side-by-side')\n    })\n  }\n\n  getCodeMirror () {\n    return inkdrop.getActiveEditor().codeMirror\n  }\n\n  yankClipboard () {\n    const state = this.vim.getVimGlobalState()\n    const text = clipboard.readText()\n    const linewise = text.indexOf('\\n') >= 0\n    state.registerController.pushText('0', 'yank', text, linewise, true)\n  }\n\n  @autobind\n  handleEditorInit (editor) {\n    this.activateMode(editor)\n  }\n\n  @autobind\n  handleVimModeChange (event, opt) {\n    debug('vim mode changed:', event)\n    const { mode } = event\n    const cm = this.getCodeMirror()\n    cm.getWrapperElement().classList.remove('insert-mode')\n    cm.getWrapperElement().classList.remove('visual-mode')\n    cm.getWrapperElement().classList.remove('normal-mode')\n    cm.getWrapperElement().classList.remove('replace-mode')\n    switch (mode) {\n      case 'normal':\n        cm.getWrapperElement().classList.add('normal-mode')\n        break\n      case 'visual':\n        cm.getWrapperElement().classList.add('visual-mode')\n        break\n      case 'replace':\n        cm.getWrapperElement().classList.add('replace-mode')\n        break\n      case 'insert':\n        cm.getWrapperElement().classList.add('insert-mode')\n        break\n    }\n  }\n\n  @autobind\n  handleEditorKeyDown (event) {\n    const keyName = event.key\n    const cm = this.getCodeMirror()\n    const vim = this.vim.maybeInitVimState(cm)\n\n    if (this.isBufferingKey()) {\n      debug('handle key buffering:', event)\n\n      if (keyName.length === 1) {\n        vim.inputState.selectedCharacter = event.key\n\n        if (typeof this.pendingCommand === 'function') {\n          this.pendingCommand(event)\n        }\n      }\n      if (keyName !== 'Ctrl' && keyName !== 'Alt' && keyName !== 'Shift' && keyName !== 'Meta') {\n        this.stopBufferingKey()\n      }\n    } else if (!this.isInsertMode()) {\n      if (/^\\d$/.test(keyName)) {\n        this.bufferKey(keyName)\n      } else {\n        // push key buffer to the repeat digit\n        const keys = vim.inputState.keyBuffer\n        vim.inputState.keyBuffer = ''\n        const keysMatcher = /^(\\d*)(.*)$/.exec(keys)\n        if (keysMatcher[1] && keysMatcher[1] !== '0') {\n          vim.inputState.pushRepeatDigit(keysMatcher[1])\n        }\n      }\n    }\n  }\n\n  @autobind\n  handleFocusEditor (event) {\n    this.yankClipboard()\n  }\n}\n\nmodule.exports = new Plugin()\n"]}